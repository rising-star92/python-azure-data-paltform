# ----------------------------------------------------------------------------------------------------------------------
# GENERAL
# ----------------------------------------------------------------------------------------------------------------------
general:
  prefix: ii
  region: EastUS
  unique_id: i1r1
  use_legacy_naming: false
  tags:
    IngeniiApplication: Azure Data Platform
    IngeniiNotice: "This resource is managed using infrastructure as code approach. Please do not make any manual changes as they will be overwritten on the next infrastructure update."

# ----------------------------------------------------------------------------------------------------------------------
# MANAGEMENT
# ----------------------------------------------------------------------------------------------------------------------
management:
  user_groups:
    admins:
      display_name: admins
    engineers:
      display_name: engineers
    analysts:
      display_name: analysts
  resource_groups:
    infra:
      iam:
        role_assignments:
          - user_group_ref_key: admins
            role_definition_name: Owner
          - user_group_ref_key: engineers
            role_definition_name: Reader
          - user_group_ref_key: analysts
            role_definition_name: Reader
    data:
      iam:
        role_assignments:
          - user_group_ref_key: admins
            role_definition_name: Owner
          - user_group_ref_key: engineers
            role_definition_name: Reader
          - user_group_ref_key: analysts
            role_definition_name: Reader
    security:
      iam:
        role_assignments:
          - user_group_ref_key: admins
            role_definition_name: Owner
          - user_group_ref_key: engineers
            role_definition_name: Reader
          - user_group_ref_key: analysts
            role_definition_name: Reader

# ----------------------------------------------------------------------------------------------------------------------
# SECURITY
# ----------------------------------------------------------------------------------------------------------------------
security:
  credentials_store:
    network:
      firewall:
        enabled: false
    iam:
      role_assignments:
        - user_group_ref_key: admins
          role_definition_name: "Key Vault Secrets Reader"
        - user_group_ref_key: engineers
          role_definition_name: "Key Vault Secrets Reader"

# ----------------------------------------------------------------------------------------------------------------------
# NETWORK
# ----------------------------------------------------------------------------------------------------------------------
network:
  firewall:
    enabled: false
    ip_access_list:
      - 151.251.5.72
  nat_gateway:
    enabled: true
  virtual_network:
    display_name: main
    address_space: 10.110.0.0/16

# ----------------------------------------------------------------------------------------------------------------------
# STORAGE
# ----------------------------------------------------------------------------------------------------------------------
storage:
  datalake:
    display_name: datalake
    network:
      firewall:
        enabled: false
    iam:
      role_assignments:
        - user_group_ref_key: admins
          role_definition_name: "Storage Blob Data Contributor"
    containers:
      utilities: # Mount in DBW Engineering(RW), Analytics
        display_name: utilities
        iam:
          role_assignments:
            - user_group_ref_key: engineers
              role_definition_name: "Storage Blob Data Contributor"
            - user_group_ref_key: analysts
              role_definition_name: "Storage Blob Data Contributor"
      raw: # Mount in DBW Engineering(RW)
        display_name: raw
      archive: # Mount in DBW Engineering(RW)
        display_name: archive
      source: # Mount in DBW Engineering(RW), Analytics
        display_name: source
        iam:
          role_assignments:
            - user_group_ref_key: engineers
              role_definition_name: "Storage Blob Data Contributor"
            - user_group_ref_key: analysts
              role_definition_name: "Storage Blob Data Reader"
      orchestration: # Mount in DBW Engineering(RW)
        display_name: orchestration
      dbt: # Mount in DBW Engineering(RW)
        display_name: dbt
      dbt_logs: # Mount in DBW Engineering(RW)
        display_name: dbt-logs
    tables:
      sftp_known_files:
        display_name: "SFTPKnownFiles"
      select1:
        display_name: "Select1"
        entities:
          empty:
            row_key: "1"
            partition_key: "1"

# ----------------------------------------------------------------------------------------------------------------------
# ANALYTICS SERVICES
# ----------------------------------------------------------------------------------------------------------------------
analytics_services:
  databricks:
    workspaces:
      engineering:
        config:
          enable_container_services: "true"
          enable_ip_access_lists: "false"
        iam:
          role_assignments:
            - user_group_ref_key: admins
              role_definition_name: Owner
            - user_group_ref_key: engineers
              role_definition_name: Owner
        clusters:
          default:
            type: single_node
            display_name: engineering
            spark_version: "8.4.x-scala2.12"
            node_type_id: "Standard_F4s"
            autotermination_minutes: 15
            docker_image_url: "ingeniisolutions/databricks-runtime:0.3.1"
        storage_mounts:
          - type: datalake
            container_name: utilities
            mount_name: utilities
          - type: datalake
            container_name: dbt
            mount_name: dbt
          - type: datalake
            container_name: dbt-logs
            mount_name: dbt-logs
          - type: datalake
            container_name: raw
            mount_name: raw
          - type: datalake
            container_name: archive
            mount_name: archive
          - type: datalake
            container_name: source
            mount_name: source
          - type: datalake
            container_name: orchestration
            mount_name: orchestration
      analytics:
        config:
          enable_container_services: "false"
          enable_ip_access_lists: "false"
        iam:
          role_assignments:
            - user_group_ref_key: admins
              role_definition_name: Owner
            - user_group_ref_key: engineers
              role_definition_name: Owner
        clusters:
          default:
            type: high_concurrency
            display_name: analytics
            spark_version: "8.4.x-scala2.12"
            node_type_id: "Standard_F4s"
            auto_scale_min_workers: 1
            auto_scale_max_workers: 4
            autotermination_minutes: 15
        storage_mounts:
          - type: datalake
            container_name: utilities
            mount_name: utilities
  datafactory:
    factories:
      orchestration:
        display_name: orchestration
        iam:
          role_assignments:
            - user_group_ref_key: engineers
              role_definition_name: Data Factory Contributor
