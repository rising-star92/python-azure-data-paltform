general:
  region: "UKSouth"
  resource_prefix: "adp01"
  tags:
    IngeniiSolutionName: "AzureDataPlatform"
    IngeniiSolutionVersion: "1.0.0"
management:
  user_groups:
    admins:
      display_name: "admins"
    engineers:
      display_name: "engineers"
    analysts:
      display_name: "analysts"
  resource_groups:
    infra:
      display_name: "infra"
    data:
      display_name: "data"
network:
  # firewall:
  #   ip_access_list:
  #   subnet_access_list:
  virtual_networks:
    main:
      display_name: "main"
      resource_group_key_name: "infra"
      address_space: "10.50.0.0/16"
      route_tables:
        public:
          display_name: "public"
        private:
          display_name: "private"
      subnets:
        data_processing_public:
          display_name: "data-processing-public"
          address_prefix: "10.50.0.0/20"
          route_table_key_name: "public"
          network_security_group_key_name: "databricks"
          service_endpoints:
            - "Microsoft.Storage"
            - "Microsoft.KeyVault"
          delegations:
            - "databricks"
        data_processing_private:
          display_name: "data-processing-private"
          address_prefix: "10.50.16.0/20"
          route_table_key_name: "private"
          network_security_group_key_name: "databricks"
          service_endpoints:
            - "Microsoft.Storage"
            - "Microsoft.KeyVault"
          delegations:
            - "databricks"
        data_analytics_public:
          display_name: "data-analytics-public"
          address_prefix: "10.50.32.0/20"
          route_table_key_name: "public"
          network_security_group_key_name: "databricks"
          service_endpoints:
            - "Microsoft.Storage"
            - "Microsoft.KeyVault"
          delegations:
            - "databricks"
        data_analytics_private:
          display_name: "data-analytics-private"
          address_prefix: "10.50.48.0/20"
          route_table_key_name: "private"
          network_security_group_key_name: "databricks"
          service_endpoints:
            - "Microsoft.Storage"
            - "Microsoft.KeyVault"
          delegations:
            - "databricks"
      subnet_delegations:
        databricks:
          name: "Databricks"
          service_delegation:
            name: "Microsoft.Databricks/workspaces"
            actions:
              - "Microsoft.Network/virtualNetworks/subnets/join/action"
              - "Microsoft.Network/virtualNetworks/subnets/prepareNetworkPolicies/action"
              - "Microsoft.Network/virtualNetworks/subnets/unprepareNetworkPolicies/action"
  network_security_groups:
    databricks:
      display_name: "databricks"
      resource_group_key_name: "infra"
storage:
  data_lakes:
    main:
      display_name: "datalake"
      resource_group_key_name: "data"
      iam:
        role_definitions:
          read_write: "Storage Blob Data Contributor"
          read_only: "Storage Blob Data Reader"
      storage_containers:
        raw:
          display_name: "raw"
          iam:
            role_assignments:
              read_write:
                - "engineers"
        orchestration:
          display_name: "orchestration"
          iam:
            role_assignments:
              read_write:
                - "engineers"
              read_only:
                - "analysts"
        utilities:
          display_name: "utilities"
          iam:
            role_assignments:
              read_only:
                - "analysts"
                - "engineers"
        data-structure:
          display_name: "data-structure"
          iam:
            role_assignments:
              read_only:
                - "analysts"
                - "engineers"
data_tools:
  azure_data_factories:
    orchestration:
      name: "data-orchestration"
      resource_group_key_name: "infra"
      identity:
        type: "SystemAssigned"
      linked_services:
        main_data_lake:
          name: "main-datalake"
          type: "azure_storage_gen_2_data_lake"
          data_lake:
            id: "main"
            iam:
              role_assignment: "read_write"
  azure_databricks_workspaces:
    data_processing:
      name: "data-processing"
      resource_group_key_name: "infra"
      sku: "premium"
      configs:
        virtual_network_key_name: "main"
        public_subnet_key_name: "data_processing_public"
        private_subnet_key_name: "data_processing_private"
        no_public_ip: true
        enable_container_services: true
      clusters:
        engineering:
          name: "engineering"
          cluster_mode: "single_node"
          worker_node_type_id: "Standard_F4s"
          auto_termination_in_minutes: 10
          azure_ad_credential_passthrough_is_enabled: false
          number_of_workers: 0
          docker_image:
            url: "ingeniisolutions/data-platform-databricks-runtime:0.0.3"
          pypi_packages:
            - name: "dbt"
              version: "0.19.1"
